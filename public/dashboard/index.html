<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mitra Command Center</title>

<style>
body{
  margin:0;
  font-family:Inter,Arial;
  background:#020617;
  color:#e5e7eb;
  overflow:hidden;
}

/* header */
.top{
  height:60px;
  background:rgba(15,23,42,.8);
  backdrop-filter:blur(20px);
  display:flex;
  align-items:center;
  padding:0 20px;
  border-bottom:1px solid #1e293b;
  font-weight:600;
  letter-spacing:.5px;
}

/* layout */
.wrap{
  display:flex;
  height:calc(100vh - 60px);
}

/* sidebar */
.side{
  width:320px;
  background:#020617;
  border-right:1px solid #1e293b;
  overflow:auto;
}

.item{
  padding:14px;
  border-bottom:1px solid #111827;
  cursor:pointer;
  transition:.2s;
}

.item:hover{
  background:#020617;
  box-shadow:inset 3px 0 0 #22c55e;
}

.phone{
  font-size:13px;
  opacity:.7;
}

.last{
  font-size:14px;
  margin-top:4px;
}

/* chat area */
.chat{
  flex:1;
  display:flex;
  flex-direction:column;
}

.messages{
  flex:1;
  overflow:auto;
  padding:30px;
}

/* bubbles */
.bubble{
  max-width:60%;
  padding:14px 16px;
  border-radius:14px;
  margin:10px 0;
  font-size:15px;
  line-height:1.4;
}

.user{
  background:#0f172a;
  border:1px solid #1e293b;
}

.ai{
  background:linear-gradient(135deg,#16a34a,#22c55e);
  color:#022c22;
  margin-left:auto;
}

/* glow */
.glow{
  color:#22c55e;
  font-weight:600;
}
</style>
</head>

<body>

<div class="top">
AI MITRA COMMAND CENTER
<div style="margin-left:auto" class="glow">‚óè LIVE</div>
</div>

<div class="wrap">

<div class="side" id="list"></div>

<div class="chat">
<div id="messages" class="messages"></div>
</div>

</div>

<script>

let all=[];

async function load(){
  const r = await fetch("/api/getChats");

  if(r.status===401){
    location.reload();
    return;
  }

  const data = await r.json();
  all = data.slice(1);

  const grouped={};
  all.forEach(r=> grouped[r[1]]=r );

  const list=document.getElementById("list");
  list.innerHTML="";

  Object.keys(grouped).reverse().forEach(p=>{
    list.innerHTML+=`
      <div class="item" onclick="openChat('${p}')">
        <div class="phone">${p}</div>
        <div class="last">${grouped[p][3]}</div>
      </div>`;
  });
}

function openChat(p){
  const box=document.getElementById("messages");
  box.innerHTML="";

  all.filter(r=>r[1]===p).forEach(r=>{
    box.innerHTML+=`
      <div class="bubble user">${r[3]}</div>
      <div class="bubble ai">${r[4]||""}</div>`;
  });
}

setInterval(load,2000);
load();

</script>
</body>
</html>
